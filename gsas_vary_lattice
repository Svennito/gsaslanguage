# echo the call so we can see what's going on
echo "$0 $1 $2 $3 $4 $5 $6"

# Check syntax
if [ "$1" = "" ]; then
	echo "$0 called without number of phase for which lattice should be varied or fixed!"
	exit 0
fi

if [ "$2" != "y" ]; then
	if [ "$2" != "n" ]; then
		echo "$0 called without proper flag (y/n) for lattice variation!"
		exit 0
	fi
fi

echo "k l o l" > temp.txt
echo "p $1" >> temp.txt
echo "v" >> temp.txt
echo "x x x x" >> temp.txt

# find out what the current flag is
grep "CRS$1  ABC   " `cat GSAS_EXP`.EXP | tail -c36 | head -c1 > flag.txt

if [ "`cat flag.txt`" = "Y" ]; then
	# the refinement flag is turned on
	if [ "$2" = "y" ]; then
		# which is what we want, no action
		echo "Lattice for phase $1 is already varying!"
	else
		# it is on, but we want it off, let's toggle it
		expedt `cat GSAS_EXP` < temp.txt
	fi
else
	# flag is either not set (off) or set to "N"
	if [ "$2" = "y" ]; then
		# it is off, but we want it on, let's toggle it
		expedt `cat GSAS_EXP` < temp.txt
	else
		# which is what we want, no action
		echo "Lattice for phase $1 is already fixed!"
	fi
fi

# Test the EXP file
grep "CRS$1  ABC   " `cat GSAS_EXP`.EXP | tail -c36 | head -c1 > flag.txt

if [ "`cat flag.txt`" = "Y" ]; then
	# the refinement flag is turned on
	if [ "$2" = "y" ]; then
		# which is what we want, no action
		echo "Lattice for phase $1 is varying as inteded!"
	else
		# it is on, but we want it off, let's toggle it
		echo "Problem! The flag is not set to what was desired!"
	fi
else
	# flag is either not set (off) or set to "N"
	if [ "$2" = "y" ]; then
		# it is off, but we want it on, let's toggle it
		echo "Problem! The flag is not set to what was desired!"
	else
		# which is what we want, no action
		echo "Lattice for phase $1 is now fixed!"
	fi
fi

echo "Changed lattice parameter refinement flag for phase $1 to $2." >> temp.tex

